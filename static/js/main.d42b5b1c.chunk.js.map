{"version":3,"sources":["modules/recognition/recognition.ts","modules/deezer/Player.tsx","App.tsx","modules/deezer/index.ts","index.tsx"],"names":["Recognition","_recognition","_commandsMap","Map","_eventListenersMap","setLanguage","lang","setAlternatives","alternativesNumber","maxAlternatives","setInterimResults","interimResults","setContinuous","continuous","_initializeEventHandlers","forEach","type","addEventListener","event","_getEventListener","results","resultIndex","result","_getCommandCallback","transcript","start","get","toLocaleLowerCase","noop","addCommand","command","set","trigger","callback","addCommands","commands","listener","removeEventListener","delete","abort","stop","SpeechRecognition","window","webkitSpeechRecognition","Error","this","Volume","volume","Box","d","alignItems","as","FaVolumeUp","paddingRight","Slider","width","value","onChange","DZ","player","setVolume","Controls","isPlaying","IconButton","variant","aria-label","icon","FaBackward","onClick","prev","FaPause","FaPlay","pause","play","FaForward","next","Song","details","px","flexGrow","fontWeight","fontSize","title","artist","name","TrackProgress","position","duration","progressValue","seek","Player","props","useDeezerSubscriptions","track","useEffect","playPlaylist","useState","getVolume","setIsPlaying","setPosition","setDuration","getCurrentTrack","setTrack","useLayoutEffect","Event","subscribe","App","ThemeProvider","CSSReset","appId","channelUrl","onload","dzRoot","document","createElement","id","body","appendChild","script","src","head","dzAsyncInit","init","initDeezer","process","location","href","ReactDOM","render","getElementById","recognition","console","log"],"mappings":"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","file":"static/js/main.d42b5b1c.chunk.js","sourcesContent":["import { noop } from 'lodash-es'\n\nimport {\n  ICommand,\n  IRecognition,\n  ISpeechEventType,\n  ISpeechEventListener,\n} from './types'\n\nconst DEFAULT_LANGUAGE = 'en-US'\nconst DEFAULT_MAX_ALTERNATIVES = 5\n\nexport class Recognition implements IRecognition {\n  private _recognition: SpeechRecognition\n  private _commandsMap = new Map<string, () => void>() //TODO: commands structure, typing\n  private _eventListenersMap = new Map<ISpeechEventType, ISpeechEventListener>()\n\n  constructor() {\n    const SpeechRecognition = (window as any).webkitSpeechRecognition\n\n    if (!SpeechRecognition) {\n      throw new Error('Speech recognition is not supported by your browser')\n    }\n\n    this._recognition = new SpeechRecognition()\n\n    this._recognition.maxAlternatives = DEFAULT_MAX_ALTERNATIVES\n    this._recognition.lang = DEFAULT_LANGUAGE\n    this._recognition.interimResults = false\n    this._recognition.continuous = false\n\n    this._initializeEventHandlers()\n  }\n\n  setLanguage = (lang: string) => {\n    this._recognition.lang = lang\n    return this\n  }\n\n  setAlternatives = (alternativesNumber: number) => {\n    this._recognition.maxAlternatives = alternativesNumber\n    return this\n  }\n\n  setInterimResults = (interimResults: boolean) => {\n    this._recognition.interimResults = interimResults\n    return this\n  }\n\n  setContinuous = (continuous: boolean) => {\n    this._recognition.continuous = continuous\n    return this\n  }\n\n  private _initializeEventHandlers = () => {\n    ;[\n      'speechstart',\n      'speechend',\n      'soundstart',\n      'soundend',\n      'nomatch',\n      'error',\n      'audiostart',\n      'audioend',\n      'result',\n      'start',\n      'end',\n    ].forEach(type =>\n      this._recognition.addEventListener(type, event =>\n        this._getEventListener(type as ISpeechEventType)(event)\n      )\n    )\n\n    this._recognition.addEventListener('result', event => {\n      const results = event.results[event.resultIndex]\n\n      for (const result of results) {\n        this._getCommandCallback(result.transcript)()\n      }\n    })\n\n    this._recognition.addEventListener('end', () => {\n      this.start()\n    })\n  }\n\n  private _getCommandCallback = (result: string) => {\n    return (\n      this._commandsMap.get(result.toLocaleLowerCase(this._recognition.lang)) ||\n      noop\n    )\n  }\n\n  private _getEventListener = (event: ISpeechEventType) => {\n    return this._eventListenersMap.get(event) || noop\n  }\n\n  addCommand = (command: ICommand) => {\n    this._commandsMap.set(\n      command.trigger.toLocaleLowerCase(this._recognition.lang),\n      command.callback\n    )\n    return this\n  }\n\n  addCommands = (commands: ICommand[]) => {\n    commands.forEach(this.addCommand)\n    return this\n  }\n\n  addEventListener = (\n    type: ISpeechEventType,\n    listener: ISpeechEventListener\n  ) => {\n    this._eventListenersMap.set(type, listener)\n  }\n\n  removeEventListener = (type: ISpeechEventType) => {\n    this._eventListenersMap.delete(type)\n  }\n\n  start = () => {\n    this._recognition.start()\n  }\n\n  abort = () => {\n    this._recognition.abort()\n  }\n\n  stop = () => {\n    this._recognition.stop()\n  }\n}\n","import React, { useState, useLayoutEffect, useEffect } from 'react'\nimport {\n  Slider,\n  SliderFilledTrack,\n  SliderThumb,\n  SliderTrack,\n  Box,\n  IconButton,\n  BoxProps,\n} from '@chakra-ui/core'\nimport {\n  FaBackward,\n  FaForward,\n  FaPlay,\n  FaPause,\n  FaVolumeUp,\n} from 'react-icons/fa'\n\nconst Volume: React.FC<{ volume: number }> = ({ volume }) => (\n  <Box d=\"flex\" alignItems=\"center\">\n    <Box as={FaVolumeUp} paddingRight=\"1\" />\n\n    <Box d=\"flex\" alignItems=\"center\">\n      <Slider width=\"24\" value={volume} onChange={DZ.player.setVolume}>\n        <SliderTrack />\n        <SliderFilledTrack />\n        <SliderThumb />\n      </Slider>\n    </Box>\n  </Box>\n)\n\nconst Controls: React.FC<{ isPlaying: boolean }> = ({ isPlaying }) => (\n  <Box>\n    <IconButton\n      variant=\"outline\"\n      aria-label=\"previous track\"\n      icon={FaBackward}\n      onClick={DZ.player.prev}\n    />\n    <IconButton\n      variant=\"outline\"\n      aria-label=\"play/pause track\"\n      icon={isPlaying ? FaPause : FaPlay}\n      onClick={isPlaying ? DZ.player.pause : DZ.player.play}\n    />\n    <IconButton\n      variant=\"outline\"\n      aria-label=\"next track\"\n      icon={FaForward}\n      onClick={DZ.player.next}\n    />\n  </Box>\n)\n\nconst Song: React.FC<{ details: DeezerSdk.Track }> = ({ details }) => (\n  <Box px=\"2\" flexGrow={1}>\n    <Box fontWeight=\"bold\" fontSize=\"md\">\n      {details?.title}\n    </Box>\n    <Box fontSize=\"xs\">{details?.artist?.name}</Box>\n  </Box>\n)\n\nconst TrackProgress: React.FC<{ position: number; duration: number }> = ({\n  position,\n  duration,\n}) => {\n  const progressValue = duration ? (position / duration) * 100 : 0\n\n  return (\n    <Slider onChange={DZ.player.seek} value={progressValue}>\n      <SliderTrack />\n      <SliderFilledTrack />\n      <SliderThumb />\n    </Slider>\n  )\n}\n\nexport const Player: React.FC<BoxProps> = props => {\n  const {\n    track,\n    volume,\n    isPlaying,\n    position,\n    duration,\n  } = useDeezerSubscriptions()\n\n  //TODO: remove in future\n  useEffect(() => {\n    DZ.player.playPlaylist(3751102562, false)\n  }, [])\n\n  return (\n    <Box {...props}>\n      <TrackProgress position={position} duration={duration} />\n\n      <Box d=\"flex\" alignItems=\"center\">\n        <Controls isPlaying={isPlaying} />\n        <Song details={track} />\n        <Volume volume={volume} />\n      </Box>\n    </Box>\n  )\n}\n\nconst useDeezerSubscriptions = () => {\n  const [volume, setVolume] = useState<number>(DZ.player.getVolume())\n  const [isPlaying, setIsPlaying] = useState<boolean>(DZ.player.isPlaying())\n  const [position, setPosition] = useState<number>(0)\n  const [duration, setDuration] = useState<number>(0)\n  const [track, setTrack] = useState<DeezerSdk.Track>(\n    DZ.player.getCurrentTrack()\n  )\n\n  useLayoutEffect(() => {\n    DZ.Event.subscribe('volume_changed', setVolume)\n    DZ.Event.subscribe('current_track', ({ track }) => setTrack(track))\n    DZ.Event.subscribe('player_play', () => setIsPlaying(true))\n    DZ.Event.subscribe('player_paused', () => setIsPlaying(false))\n    DZ.Event.subscribe('player_position', ([position, duration]: number[]) => {\n      setPosition(position)\n      setDuration(duration)\n    })\n  }, [])\n\n  return { track, volume, isPlaying, position, duration }\n}\n","import React from 'react'\nimport { ThemeProvider, Box, CSSReset } from '@chakra-ui/core'\n\nimport { Player } from './modules/deezer'\n\nexport function App() {\n  return (\n    <ThemeProvider>\n      <CSSReset />\n      <Box>\n        <Player px=\"2\" />\n      </Box>\n    </ThemeProvider>\n  )\n}\n","type InitOptions = {\n  appId: string\n  channelUrl: string\n  onload: () => void\n}\n\nconst DEEZER_SDK_CDN_LINK = 'https://e-cdns-files.dzcdn.net/js/min/dz.js'\nconst DEEZER_CONTAINER_ID = 'dz-root'\n\nconst initDeezer = ({ appId, channelUrl, onload }: InitOptions) => {\n  const dzRoot = document.createElement('div')\n\n  dzRoot.id = DEEZER_CONTAINER_ID\n  document.body.appendChild(dzRoot)\n\n  const script = document.createElement('script')\n\n  script.src = DEEZER_SDK_CDN_LINK\n\n  document.head.appendChild(script)\n  ;(window as any).dzAsyncInit = () => {\n    DZ.init({\n      appId,\n      channelUrl,\n      player: {\n        onload,\n      },\n    })\n  }\n}\n\nexport { Player } from './Player'\nexport { api } from './api'\n\nexport { initDeezer }\n","import React from 'react'\nimport ReactDOM from 'react-dom'\n\nimport { Recognition } from './modules/recognition/recognition'\nimport { initDeezer } from './modules/deezer'\n\nimport { App } from './App'\n\nimport './index.css'\n\nconst appId = process.env.REACT_APP_DEEZER_APP_ID || ''\nconst channelUrl = window.location.href + '/channel.html' //TODO: May cause some routing issues in future, but for now it's okay\n\ninitDeezer({\n  appId,\n  channelUrl,\n  onload: () => {\n    ReactDOM.render(<App />, document.getElementById('root'))\n\n    const recognition = new Recognition()\n      .setLanguage('ru-RU')\n      .addCommand({ trigger: 'играть', callback: DZ.player.play })\n      .addCommand({ trigger: 'пауза', callback: DZ.player.pause })\n      .addCommand({ trigger: 'следующий', callback: DZ.player.next })\n      .addCommand({ trigger: 'предыдущий', callback: DZ.player.prev })\n      .addCommand({\n        trigger: 'громче',\n        callback: () => DZ.player.setVolume(DZ.player.getVolume() + 20),\n      })\n      .addCommand({\n        trigger: 'тише',\n        callback: () => DZ.player.setVolume(DZ.player.getVolume() - 20),\n      })\n\n    recognition.addEventListener('result', event => {\n      console.log(event)\n    })\n\n    recognition.start()\n  },\n})\n"],"sourceRoot":""}