{"version":3,"sources":["modules/recognition/recognition.ts","modules/deezer/player/Player.tsx","App.tsx","modules/deezer/index.ts","index.tsx"],"names":["Recognition","_recognition","_commandsMap","Map","_eventListenersMap","setLanguage","lang","setAlternatives","alternativesNumber","maxAlternatives","setInterimResults","interimResults","setContinuous","continuous","_initializeEventHandlers","forEach","type","addEventListener","event","_getEventListener","results","resultIndex","result","_getCommandCallback","transcript","start","get","toLocaleLowerCase","noop","addCommand","command","set","trigger","callback","addCommands","commands","listener","removeEventListener","delete","abort","stop","SpeechRecognition","window","webkitSpeechRecognition","Error","this","Volume","volume","Box","d","alignItems","as","FaVolumeUp","paddingRight","Slider","width","value","onChange","DZ","player","setVolume","Controls","isPlaying","IconButton","variant","aria-label","icon","FaBackward","onClick","prev","FaPause","FaPlay","pause","play","FaForward","next","Song","details","boxProps","fontWeight","fontSize","title","artist","name","Player","useDeezerSubscriptions","track","position","duration","useEffect","playAlbum","flexGrow","seek","isNaN","px","useState","getVolume","setIsPlaying","setPosition","setDuration","getCurrentTrack","setTrack","useLayoutEffect","Event","subscribe","App","ThemeProvider","CSSReset","appId","channelUrl","dzRoot","document","createElement","id","body","appendChild","script","src","async","onPlayerLoad","head","dzAsyncInit","init","onload","initDeezer","location","href","ReactDOM","render","getElementById","recognition","console","log"],"mappings":"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","file":"static/js/main.c516a06c.chunk.js","sourcesContent":["import { noop } from 'lodash-es'\n\nimport {\n  ICommand,\n  IRecognition,\n  ISpeechEventType,\n  ISpeechEventListener,\n} from './types'\n\nconst DEFAULT_LANGUAGE = 'en-US'\nconst DEFAULT_MAX_ALTERNATIVES = 5\n\nexport class Recognition implements IRecognition {\n  private _recognition: SpeechRecognition\n  private _commandsMap = new Map<string, () => void>() //TODO: commands structure, typing\n  private _eventListenersMap = new Map<ISpeechEventType, ISpeechEventListener>()\n\n  constructor() {\n    const SpeechRecognition = (window as any).webkitSpeechRecognition\n\n    if (!SpeechRecognition) {\n      throw new Error('Speech recognition is not supported by your browser')\n    }\n\n    this._recognition = new SpeechRecognition()\n\n    this._recognition.maxAlternatives = DEFAULT_MAX_ALTERNATIVES\n    this._recognition.lang = DEFAULT_LANGUAGE\n    this._recognition.interimResults = false\n    this._recognition.continuous = false\n\n    this._initializeEventHandlers()\n  }\n\n  setLanguage = (lang: string) => {\n    this._recognition.lang = lang\n    return this\n  }\n\n  setAlternatives = (alternativesNumber: number) => {\n    this._recognition.maxAlternatives = alternativesNumber\n    return this\n  }\n\n  setInterimResults = (interimResults: boolean) => {\n    this._recognition.interimResults = interimResults\n    return this\n  }\n\n  setContinuous = (continuous: boolean) => {\n    this._recognition.continuous = continuous\n    return this\n  }\n\n  private _initializeEventHandlers = () => {\n    ;[\n      'speechstart',\n      'speechend',\n      'soundstart',\n      'soundend',\n      'nomatch',\n      'error',\n      'audiostart',\n      'audioend',\n      'result',\n      'start',\n      'end',\n    ].forEach(type =>\n      this._recognition.addEventListener(type, event =>\n        this._getEventListener(type as ISpeechEventType)(event)\n      )\n    )\n\n    this._recognition.addEventListener('result', event => {\n      const results = event.results[event.resultIndex]\n\n      for (const result of results) {\n        this._getCommandCallback(result.transcript)()\n      }\n    })\n\n    this._recognition.addEventListener('end', () => {\n      this.start()\n    })\n  }\n\n  private _getCommandCallback = (result: string) => {\n    return (\n      this._commandsMap.get(result.toLocaleLowerCase(this._recognition.lang)) ||\n      noop\n    )\n  }\n\n  private _getEventListener = (event: ISpeechEventType) => {\n    return this._eventListenersMap.get(event) || noop\n  }\n\n  addCommand = (command: ICommand) => {\n    this._commandsMap.set(\n      command.trigger.toLocaleLowerCase(this._recognition.lang),\n      command.callback\n    )\n    return this\n  }\n\n  addCommands = (commands: ICommand[]) => {\n    commands.forEach(this.addCommand)\n    return this\n  }\n\n  addEventListener = (\n    type: ISpeechEventType,\n    listener: ISpeechEventListener\n  ) => {\n    this._eventListenersMap.set(type, listener)\n  }\n\n  removeEventListener = (type: ISpeechEventType) => {\n    this._eventListenersMap.delete(type)\n  }\n\n  start = () => {\n    this._recognition.start()\n  }\n\n  abort = () => {\n    this._recognition.abort()\n  }\n\n  stop = () => {\n    this._recognition.stop()\n  }\n}\n","import React, { useState, useLayoutEffect, useEffect } from 'react'\nimport {\n  Slider,\n  SliderFilledTrack,\n  SliderThumb,\n  SliderTrack,\n  Box,\n  IconButton,\n  BoxProps,\n} from '@chakra-ui/core'\nimport {\n  FaBackward,\n  FaForward,\n  FaPlay,\n  FaPause,\n  FaVolumeUp,\n} from 'react-icons/fa'\n\nconst Volume: React.FC<{ volume: number }> = ({ volume }) => (\n  <Box d=\"flex\" alignItems=\"center\">\n    <Box as={FaVolumeUp} paddingRight=\"1\" />\n\n    <Box d=\"flex\" alignItems=\"center\">\n      <Slider width=\"24\" value={volume} onChange={DZ.player.setVolume}>\n        <SliderTrack />\n        <SliderFilledTrack />\n        <SliderThumb />\n      </Slider>\n    </Box>\n  </Box>\n)\n\nconst Controls: React.FC<{ isPlaying: boolean }> = ({ isPlaying }) => (\n  <Box>\n    <IconButton\n      variant=\"outline\"\n      aria-label=\"previous track\"\n      icon={FaBackward}\n      onClick={DZ.player.prev}\n    />\n    <IconButton\n      variant=\"outline\"\n      aria-label=\"play/pause track\"\n      icon={isPlaying ? FaPause : FaPlay}\n      onClick={isPlaying ? DZ.player.pause : DZ.player.play}\n    />\n    <IconButton\n      variant=\"outline\"\n      aria-label=\"next track\"\n      icon={FaForward}\n      onClick={DZ.player.next}\n    />\n  </Box>\n)\n\nconst Song: React.FC<{ details: DeezerSdk.Track } & BoxProps> = ({\n  details,\n  ...boxProps\n}) => (\n  <Box {...boxProps}>\n    <Box fontWeight=\"bold\" fontSize=\"md\">\n      {details?.title}\n    </Box>\n    <Box fontSize=\"xs\">{details?.artist?.name}</Box>\n  </Box>\n)\n\nexport const Player = () => {\n  const {\n    track,\n    volume,\n    isPlaying,\n    position,\n    duration,\n  } = useDeezerSubscriptions()\n\n  //TODO: remove in future\n  useEffect(() => {\n    DZ.player.playAlbum(14048532)\n  }, [])\n\n  return (\n    <Box>\n      <Box d=\"flex\" flexGrow={1}>\n        <Slider\n          onChange={DZ.player.seek}\n          value={\n            isNaN((position / duration) * 100) ? 0 : (position / duration) * 100\n          }\n        >\n          <SliderTrack />\n          <SliderFilledTrack />\n          <SliderThumb />\n        </Slider>\n      </Box>\n\n      <Box d=\"flex\" alignItems=\"center\">\n        <Controls isPlaying={isPlaying} />\n        <Song flexGrow={1} px=\"3\" details={track} />\n        <Volume volume={volume} />\n      </Box>\n    </Box>\n  )\n}\n\nconst useDeezerSubscriptions = () => {\n  const [volume, setVolume] = useState<number>(DZ.player.getVolume())\n  const [isPlaying, setIsPlaying] = useState<boolean>(DZ.player.isPlaying())\n  const [position, setPosition] = useState<number>(0)\n  const [duration, setDuration] = useState<number>(0)\n  const [track, setTrack] = useState<DeezerSdk.Track>(\n    DZ.player.getCurrentTrack()\n  )\n\n  useLayoutEffect(() => {\n    DZ.Event.subscribe('volume_changed', setVolume)\n    DZ.Event.subscribe('current_track', ({ track }) => setTrack(track))\n    DZ.Event.subscribe('player_play', () => setIsPlaying(true))\n    DZ.Event.subscribe('player_paused', () => setIsPlaying(false))\n    DZ.Event.subscribe('player_position', ([position, duration]: number[]) => {\n      setPosition(position)\n      setDuration(duration)\n    })\n  }, [])\n\n  return { track, volume, isPlaying, position, duration }\n}\n","import React from 'react'\nimport { ThemeProvider, Box, CSSReset } from '@chakra-ui/core'\n\nimport { Player } from './modules/deezer/player'\n\nexport function App() {\n  return (\n    <ThemeProvider>\n      <CSSReset />\n      <Box>\n        <Box />\n        <Box px=\"2\">\n          <Player />\n        </Box>\n      </Box>\n    </ThemeProvider>\n  )\n}\n","type InitOptions = {\n  appId: string\n  channelUrl: string\n}\n\nconst DEEZER_SDK_CDN_LINK = 'https://e-cdns-files.dzcdn.net/js/min/dz.js'\nconst DEEZER_CONTAINER_ID = 'dz-root'\n\nexport const initDeezer = ({ appId, channelUrl }: InitOptions) => {\n  const dzRoot = document.createElement('div')\n\n  dzRoot.id = DEEZER_CONTAINER_ID\n  document.body.appendChild(dzRoot)\n\n  const script = document.createElement('script')\n\n  script.src = DEEZER_SDK_CDN_LINK\n  script.async = true\n\n  return (onPlayerLoad: () => void) => {\n    document.head.appendChild(script)\n    ;(window as any).dzAsyncInit = () => {\n      DZ.init({\n        appId,\n        channelUrl,\n        player: {\n          onload: onPlayerLoad,\n        },\n      })\n    }\n  }\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\n\nimport { Recognition } from './modules/recognition/recognition'\nimport { initDeezer } from './modules/deezer'\n\nimport { App } from './App'\n\nimport './index.css'\n\ninitDeezer({ appId: '404684', channelUrl: window.location.href })(() => {\n  ReactDOM.render(<App />, document.getElementById('root'))\n\n  const recognition = new Recognition()\n    .setLanguage('ru-RU')\n    .addCommand({ trigger: 'играть', callback: DZ.player.play })\n    .addCommand({ trigger: 'пауза', callback: DZ.player.pause })\n    .addCommand({ trigger: 'следующий', callback: DZ.player.next })\n    .addCommand({ trigger: 'предыдущий', callback: DZ.player.prev })\n    .addCommand({\n      trigger: 'громче',\n      callback: () => DZ.player.setVolume(DZ.player.getVolume() + 10),\n    })\n    .addCommand({\n      trigger: 'тише',\n      callback: () => DZ.player.setVolume(DZ.player.getVolume() - 10),\n    })\n\n  recognition.addEventListener('result', event => {\n    console.log(event)\n  })\n\n  recognition.start()\n})\n"],"sourceRoot":""}